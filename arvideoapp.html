<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permanent AR Photo Frame - MindAR (With Sound)</title>
    <!-- Load A-Frame and the MindAR A-Frame library -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        
        #ar-instructions {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.95); color: #1F2937;
            padding: 12px 24px; border-radius: 10px; text-align: center;
            z-index: 100; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-weight: 600; font-size: 1rem;
            transition: opacity 0.3s ease-in-out;
        }

        /* Style for the 'Tap to Play' overlay */
        #play-prompt {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.7); color: white;
            display: none; /* Hidden by default */
            justify-content: center; align-items: center;
            flex-direction: column; z-index: 101;
            font-size: 1.5rem; font-weight: bold;
            cursor: pointer;
        }
        #play-prompt.visible { display: flex; }
    </style>
</head>
<body>

    <div id="ar-instructions">
        **Instructions:** Point the camera at your photo frame image!
    </div>
    
    <!-- This overlay will appear if the browser prevents automatic sound playback -->
    <div id="play-prompt">
        <p>Tap anywhere to enable sound and video.</p>
        <p class="text-sm">(Browser security requires a tap to play audio)</p>
    </div>

    <!-- 
        1. THE SCENE SETUP 
        !!! IMPORTANT: Replace this placeholder with your MindAR target URL !!!
    -->
    <a-scene 
        mindar-image="imageTargetSrc: YOUR_HOSTED_TARGET_FILE.mind;"
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false"
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights: true"
    >
        <a-camera active="false" position="0 0 0"></a-camera>

        <!-- 2. ASSETS: Pre-load the video file -->
        <a-assets>
            <!-- 
                *** IMPORTANT: The 'muted' attribute is REMOVED here. ***
                !!! REPLACE the src URL below with the direct public link to your video file (.mp4) !!!
            -->
            <video id="gift-video" 
                   autoplay loop playsinline webkit-playsinline 
                   src="YOUR_HOSTED_VIDEO_FILE.mp4">
            </video>
        </a-assets>

        <!-- 3. THE AR ANCHOR: This entity follows the detected image target -->
        <a-entity mindar-image-target="targetIndex: 0">

            <!-- 4. THE CONTENT: A video plane that is attached to the anchor -->
            <a-video 
                src="#gift-video" 
                width="1" height="0.56" 
                position="0 0 0" 
                rotation="0 0 0"
                scale="1 1 1"
            ></a-video>

        </a-entity>
    </a-scene>

    <script>
        window.onload = function() {
            const video = document.getElementById('gift-video');
            const scene = document.querySelector('a-scene');
            const playPrompt = document.getElementById('play-prompt');

            // Function to attempt playing the video with sound
            function attemptPlay() {
                // If the video is paused, attempt to play it with sound
                if (video.paused || video.muted) {
                    const playPromise = video.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            // Success: video is playing, hide prompt and ensure it's unmuted
                            playPrompt.classList.remove('visible');
                            video.muted = false; 
                        }).catch(error => {
                            // Failure: Browser blocked play (usually due to sound)
                            console.error("Video play failed (requires user interaction):", error);
                            playPrompt.classList.add('visible'); // Show the prompt
                        });
                    }
                } else {
                    playPrompt.classList.remove('visible'); // Already playing
                }
            }

            // 1. When target image is found, attempt to play with sound
            scene.addEventListener('targetFound', attemptPlay);

            // 2. Pause video when target image is lost
            scene.addEventListener('targetLost', () => {
                if (!video.paused) {
                    video.pause();
                    // Optionally, keep the prompt hidden until the target is found again
                }
            });
            
            // 3. Click handler (the required user interaction for sound)
            playPrompt.addEventListener('click', attemptPlay);
            document.body.addEventListener('click', attemptPlay);
        };
    </script>

</body>
</html>